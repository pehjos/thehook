import { connectToDatabase } from "../util/mongodb";

export async function getServerSideProps({ req, res,context }) {
    res.setHeader(
      'Cache-Control',
      'public, s-maxage=10, stale-while-revalidate=59'
    )
    // Get posts on SSR
    const { db } = await connectToDatabase();
    const posts = await db
      .collection("posts")
      .find()
      .sort({ timestamp: -1 })
      .toArray();
  
    return {
      props: {
        posts: posts.map((post) => ({
          _id: post._id.toString(),
         title: post.title,
        description: post. description,
          image: post.image,
          video: post.video,
         name: post.name,
         likes:post.likes,
         likeId:post.likeId,
        comments:post.comments,
          email: post.email,
          userImg: post.userImg,
          createdAt: post.createdAt,
          reposter:post.reposter,
        })),
      },
    };
  }
  
  